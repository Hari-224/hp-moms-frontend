import{a as Y,e as $,r as g,x as T,j as e,P as G,M as f,f as p,b as J,y as U,z as I}from"./index-B5aJpQwO.js";import{u as L}from"./useQuery-DiLk-DaS.js";import{u as W}from"./useMutation-CDmglRiW.js";import{o as C}from"./api-DOR-wefx.js";import{L as B,C as w,a as O,b as k,c as z,S as Z,X as ee}from"./Card-BgyJxnnv.js";import{B as F,S as P}from"./Badge-Bb7NU6h0.js";import{E as se}from"./EmptyState-idfWPYnV.js";import{M as ae}from"./Modal-B6DbCECy.js";import{I as te}from"./Input-DSy_cLET.js";import{B as j}from"./Button-CiOENXfr.js";import{C as re}from"./calendar-CwUE91eJ.js";import{E as ne}from"./eye-BawcbnTh.js";import{C as de}from"./check-CZ9WrWSr.js";import"./user-DVTd2ZHA.js";function ve(){var q,A,E;const{userData:N}=Y(),H=$(),[l,Q]=g.useState(new Date().toISOString().split("T")[0]),[x,D]=g.useState(""),[r,y]=g.useState(null),[u,S]=g.useState("aggregated"),i=N==null?void 0:N.agencyId,{data:b,isLoading:K}=L({queryKey:["agencyOrders",i,l,x],queryFn:()=>C.getAgencyOrders(i,{date:l,mealType:x||void 0}),enabled:!!i}),{data:v,isLoading:ce}=L({queryKey:["aggregatedOrders",i,l,x],queryFn:()=>C.getAggregated(i,l,x||"lunch"),enabled:!!i&&u==="aggregated"}),M=W({mutationFn:({orderId:s,status:n})=>C.updateStatus(s,n),onSuccess:()=>{I.success("Order status updated!"),H.invalidateQueries(["agencyOrders"])},onError:s=>{I.error(s.message||"Failed to update status")}}),h=((q=b==null?void 0:b.data)==null?void 0:q.orders)||[];(A=v==null?void 0:v.data)!=null&&A.aggregated;const R=T(h,"houseName");return T(h,"mealType"),K?e.jsx(B,{children:e.jsx(G,{})}):e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Orders"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"View and manage orders from all houses"})]})}),e.jsx(w,{children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-secondary-400"}),e.jsx(te,{type:"date",value:l,onChange:s=>Q(s.target.value),className:"w-40"})]}),e.jsxs("select",{value:x,onChange:s=>D(s.target.value),className:"input w-40",children:[e.jsx("option",{value:"",children:"All Meals"}),Object.entries(f).map(([s,n])=>e.jsx("option",{value:s,children:n},s))]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(j,{variant:u==="aggregated"?"primary":"secondary",size:"sm",onClick:()=>S("aggregated"),children:"Aggregated"}),e.jsx(j,{variant:u==="individual"?"primary":"secondary",size:"sm",onClick:()=>S("individual"),children:"Individual"})]})]})})}),u==="aggregated"&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(f).map(([s,n])=>{const a=h.filter(t=>t.mealType===s),o=a.reduce((t,d)=>{var c;return t+(((c=d.items)==null?void 0:c.reduce((_,X)=>_+X.quantity,0))||0)},0),V=a.reduce((t,d)=>t+(d.total||0),0),m={};return a.forEach(t=>{var d;(d=t.items)==null||d.forEach(c=>{m[c.name]||(m[c.name]={quantity:0,total:0}),m[c.name].quantity+=c.quantity,m[c.name].total+=c.quantity*c.priceAtOrder})}),e.jsxs(w,{children:[e.jsxs(k,{className:"pb-2",children:[e.jsx(z,{className:"text-base",children:n}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[a.length," orders • ",o," items"]})]}),e.jsxs(O,{className:"pt-0",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600 mb-3",children:p(V)}),Object.keys(m).length>0&&e.jsx("div",{className:"space-y-1 text-sm border-t border-secondary-100 pt-3",children:Object.entries(m).sort((t,d)=>d[1].quantity-t[1].quantity).slice(0,5).map(([t,d])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-600",children:t}),e.jsxs("span",{className:"font-medium",children:["×",d.quantity]})]},t))})]})]},s)})}),u==="individual"&&e.jsx(e.Fragment,{children:h.length===0?e.jsx(se,{icon:Z,title:"No Orders Found",description:`No orders for ${J(l,"dd MMMM yyyy")}`}):e.jsx("div",{className:"space-y-6",children:Object.entries(R).map(([s,n])=>e.jsxs(w,{children:[e.jsxs(k,{children:[e.jsx(z,{children:s}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[n.length," orders • ",p(n.reduce((a,o)=>a+(o.total||0),0))]})]}),e.jsx(O,{children:e.jsx("div",{className:"space-y-3",children:n.map(a=>{var o;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-secondary-900",children:a.customerName}),e.jsx(F,{variant:"info",size:"sm",children:f[a.mealType]})]}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[((o=a.items)==null?void 0:o.length)||0," items • ",U(a.createdAt)]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-secondary-900",children:p(a.total)}),e.jsx(P,{status:a.status}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>y(a),children:e.jsx(ne,{className:"h-4 w-4"})})]})]},a.id)})})})]},s))})})]}),e.jsx(ae,{isOpen:!!r,onClose:()=>y(null),title:"Order Details",size:"md",children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Customer"}),e.jsx("span",{className:"font-medium text-secondary-900",children:r.customerName})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"House"}),e.jsx("span",{className:"font-medium text-secondary-900",children:r.houseName})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Meal"}),e.jsx(F,{variant:"info",children:f[r.mealType]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Status"}),e.jsx(P,{status:r.status})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-secondary-900 mb-2",children:"Items"}),e.jsx("div",{className:"space-y-2",children:(E=r.items)==null?void 0:E.map((s,n)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-secondary-600",children:[s.name," × ",s.quantity]}),e.jsx("span",{className:"text-secondary-900",children:p(s.priceAtOrder*s.quantity)})]},n))})]}),e.jsxs("div",{className:"flex justify-between pt-3 border-t border-secondary-200",children:[e.jsx("span",{className:"font-semibold text-secondary-900",children:"Total"}),e.jsx("span",{className:"font-bold text-primary-600",children:p(r.total)})]}),r.status==="placed"&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(j,{variant:"danger",className:"flex-1",onClick:()=>{M.mutate({orderId:r.id,status:"cancelled"}),y(null)},children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Reject"]}),e.jsxs(j,{className:"flex-1",onClick:()=>{M.mutate({orderId:r.id,status:"confirmed"}),y(null)},children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Confirm"]})]})]})})]})}export{ve as default};
