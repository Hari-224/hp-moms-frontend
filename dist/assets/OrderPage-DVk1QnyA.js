import{j as e,d as i,a as R,e as X,r as w,g as G,M as J,P as W,f as d,z as y}from"./index-B5aJpQwO.js";import{u as Z}from"./useQuery-DiLk-DaS.js";import{u as ee}from"./useMutation-CDmglRiW.js";import{o as se,m as te}from"./api-DOR-wefx.js";import{X as ae,u as ne,e as re,L as S,S as ce,C as q,a as P,b as le,c as oe}from"./Card-BgyJxnnv.js";import{B as E}from"./Badge-Bb7NU6h0.js";import{c as m,B as j,C as ie}from"./Button-CiOENXfr.js";import{M as de}from"./Modal-B6DbCECy.js";import{C as me}from"./clock-Ol14wkjx.js";import{P as B}from"./plus-DsVY0QKG.js";import{C as xe}from"./check-CZ9WrWSr.js";import"./user-DVTd2ZHA.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=m("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=m("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=m("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=m("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=m("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ye={info:{container:"bg-blue-50 border-blue-200",icon:"text-blue-500",title:"text-blue-800",description:"text-blue-700"},success:{container:"bg-success-50 border-success-200",icon:"text-success-500",title:"text-success-800",description:"text-success-700"},warning:{container:"bg-warning-50 border-warning-200",icon:"text-warning-500",title:"text-warning-800",description:"text-warning-700"},danger:{container:"bg-danger-50 border-danger-200",icon:"text-danger-500",title:"text-danger-800",description:"text-danger-700"}},je={info:he,success:ue,warning:fe,danger:z};function ge({variant:n="info",title:o,children:g,onClose:N,className:c}){const r=ye[n],x=je[n];return e.jsxs("div",{className:i("flex p-4 rounded-lg border",r.container,c),role:"alert",children:[e.jsx(x,{className:i("h-5 w-5 flex-shrink-0 mt-0.5",r.icon)}),e.jsxs("div",{className:"ml-3 flex-1",children:[o&&e.jsx("h3",{className:i("text-sm font-medium",r.title),children:o}),g&&e.jsx("div",{className:i("text-sm",r.description,o&&"mt-1"),children:g})]}),N&&e.jsx("button",{onClick:N,className:i("ml-auto flex-shrink-0",r.icon,"hover:opacity-70"),children:e.jsx(ae,{className:"h-5 w-5"})})]})}function qe(){var L,T;const{userData:n}=R(),o=X(),{activeDate:g,setActiveDate:N}=ne(),{items:c,addItem:r,updateQuantity:x,removeItem:Ne,clearCart:Q,getTotal:v,getItemCount:k}=re(),[u,F]=w.useState(null),[_,h]=w.useState(!1),p=n==null?void 0:n.agencyId,H=n==null?void 0:n.houseId,b=new Date().toISOString().split("T")[0],{data:l,isLoading:Y}=Z({queryKey:["dailyMenu",p,b],queryFn:()=>te.getDailyMenu(p,b),enabled:!!p}),I=ee({mutationFn:s=>se.place(s),onSuccess:()=>{y.success("Order placed successfully!"),Q(),h(!1),o.invalidateQueries(["myOrders"])},onError:s=>{y.error(s.message||"Failed to place order")}}),f=((L=l==null?void 0:l.data)==null?void 0:L.menu)||{},M=((T=l==null?void 0:l.data)==null?void 0:T.cutoffTimes)||{},C=w.useMemo(()=>Object.entries(G).filter(([s,t])=>{var a;return((a=f[t])==null?void 0:a.length)>0}).map(([s,t])=>({type:t,label:J[t],items:f[t]||[],cutoff:M[t],isLocked:f[`${t}Locked`]})),[f,M]),A=s=>{if(!s)return!1;const t=new Date,[a,K]=s.split(":").map(Number),O=new Date;return O.setHours(a,K,0,0),t>O},$=(s,t)=>{r({menuItemId:s.id,name:s.name,price:s.price,quantity:1,mealType:t}),y.success(`${s.name} added to cart`)},D=s=>{const t=c.find(a=>a.menuItemId===s);return(t==null?void 0:t.quantity)||0},U=()=>{if(c.length===0){y.error("Your cart is empty");return}h(!0)},V=()=>{const s=c.reduce((t,a)=>(t[a.mealType]||(t[a.mealType]=[]),t[a.mealType].push({menuItemId:a.menuItemId,name:a.name,quantity:a.quantity,priceAtOrder:a.price}),t),{});Object.entries(s).forEach(([t,a])=>{I.mutate({houseId:H,agencyId:p,date:b,mealType:t,items:a})})};return Y?e.jsx(S,{children:e.jsx(W,{})}):e.jsxs(S,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Order Food"}),e.jsxs("p",{className:"text-secondary-600 mt-1",children:["Today's menu - ",new Date().toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"})]})]}),k()>0&&e.jsxs(j,{onClick:U,className:"relative",children:[e.jsx(ce,{className:"h-5 w-5 mr-2"}),"View Cart (",k(),")",e.jsx("span",{className:"ml-2 font-semibold",children:d(v())})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:C.map(s=>e.jsxs("button",{onClick:()=>F(u===s.type?null:s.type),className:`px-4 py-2 rounded-lg font-medium whitespace-nowrap transition-colors ${u===s.type?"bg-primary-600 text-white":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200"}`,children:[s.label,s.isLocked&&e.jsx(E,{variant:"danger",size:"sm",className:"ml-2",children:"Locked"})]},s.type))}),C.length===0?e.jsx(q,{children:e.jsxs(P,{className:"py-12 text-center",children:[e.jsx(ie,{className:"h-16 w-16 mx-auto mb-4 text-secondary-300"}),e.jsx("h3",{className:"text-lg font-medium text-secondary-900 mb-2",children:"No Menu Available"}),e.jsx("p",{className:"text-secondary-500",children:"Today's menu hasn't been published yet. Check back later!"})]})}):C.filter(s=>!u||u===s.type).map(s=>e.jsxs(q,{children:[e.jsx(le,{className:"flex flex-row items-center justify-between",children:e.jsxs("div",{children:[e.jsx(oe,{children:s.label}),s.cutoff&&e.jsxs("p",{className:"text-sm text-secondary-500 mt-1 flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),"Cutoff: ",s.cutoff,A(s.cutoff)&&e.jsx(E,{variant:"danger",size:"sm",className:"ml-2",children:"Past cutoff"})]})]})}),e.jsx(P,{children:s.isLocked||A(s.cutoff)?e.jsxs(ge,{variant:"warning",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{className:"ml-2",children:["Orders for ",s.label.toLowerCase()," are no longer accepted."]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.items.map(t=>{const a=D(t.id);return e.jsxs("div",{className:"bg-secondary-50 rounded-lg p-4 flex flex-col",children:[t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:t.name,className:"w-full h-32 object-cover rounded-lg mb-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-secondary-900",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-secondary-500 mt-1",children:t.description}),e.jsx("p",{className:"text-lg font-bold text-primary-600 mt-2",children:d(t.price)})]}),e.jsx("div",{className:"mt-3",children:a===0?e.jsxs(j,{variant:"outline",className:"w-full",onClick:()=>$(t,s.type),children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Add"]}):e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg border border-secondary-200 p-1",children:[e.jsx("button",{onClick:()=>x(t.id,a-1),className:"p-2 text-secondary-600 hover:text-danger-600",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-secondary-900",children:a}),e.jsx("button",{onClick:()=>x(t.id,a+1),className:"p-2 text-secondary-600 hover:text-success-600",children:e.jsx(B,{className:"h-4 w-4"})})]})})]},t.id)})})})]},s.type))]}),e.jsx(de,{isOpen:_,onClose:()=>h(!1),title:"Confirm Order",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"divide-y divide-secondary-100",children:c.map(s=>e.jsxs("div",{className:"py-3 flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary-900",children:s.name}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[d(s.price)," Ã— ",s.quantity]})]}),e.jsx("p",{className:"font-semibold text-secondary-900",children:d(s.price*s.quantity)})]},s.menuItemId))}),e.jsxs("div",{className:"border-t border-secondary-200 pt-4 flex justify-between",children:[e.jsx("span",{className:"text-lg font-semibold text-secondary-900",children:"Total"}),e.jsx("span",{className:"text-lg font-bold text-primary-600",children:d(v())})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{variant:"secondary",className:"flex-1",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(j,{className:"flex-1",onClick:V,isLoading:I.isPending,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Confirm Order"]})]})]})})]})}export{qe as default};
