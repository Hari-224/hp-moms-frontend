import{a as O,e as Q,r as c,j as e,P as U,z as y}from"./index-Bz7pwbB9.js";import{u as $}from"./useQuery-BBL-UJvn.js";import{u as K}from"./useMutation-bJ9c7Hmc.js";import{u as R}from"./index.esm-nOunc93L.js";import{t as G,o as J,s as u,e as W}from"./types-2AX18-p6.js";import{h as T}from"./api-Bp1mAEYF.js";import{L as B,C as M,a as E,B as Y,U as Z}from"./Card-D8tmHTuL.js";import{S as _}from"./Badge-DsqiXPr3.js";import{E as D}from"./EmptyState-BtxfN_BO.js";import{M as ee,C as se}from"./Modal-CfOO-JW_.js";import{I as x,S as ae,T as re}from"./Input-DkrhA-KG.js";import{B as l}from"./Button-DxGI9h4D.js";import{P as X}from"./plus-D4MauG9m.js";import{S as te}from"./search-o6vBxrYE.js";import{M as le,S as ne}from"./square-pen-GRf-veb6.js";import{P as oe}from"./phone-CAzyxAd7.js";import{T as me}from"./trash-2-BcqysFBi.js";import"./user-BIVSRI51.js";const ie=J({name:u().min(2,"Name must be at least 2 characters"),type:W(["BigHouse","SmallHouse"]),address:u().min(5,"Address must be at least 5 characters"),adminName:u().min(2,"Admin name is required"),adminPhone:u().min(10,"Valid phone number is required")});function Te(){var b,S,v,C,w,H;const{userData:h}=O(),L=Q(),[q,r]=c.useState(!1),[a,p]=c.useState(null),[i,f]=c.useState(null),[n,V]=c.useState(""),d=h==null?void 0:h.agencyId,{register:o,handleSubmit:k,reset:j,formState:{errors:m}}=R({resolver:G(ie)}),{data:t,isLoading:z}=$({queryKey:["agencyHouses",d],queryFn:async()=>await T.list(d),enabled:!!d}),g=K({mutationFn:s=>T.create({...s,agencyId:d}),onSuccess:()=>{y.success("House created successfully!"),r(!1),j(),L.invalidateQueries(["agencyHouses"])},onError:s=>{y.error(s.message||"Failed to create house")}}),N=(((b=t==null?void 0:t.data)==null?void 0:b.houses)||(t==null?void 0:t.houses)||[]).filter(s=>{var P,A;return((P=s.name)==null?void 0:P.toLowerCase().includes(n.toLowerCase()))||((A=s.address)==null?void 0:A.toLowerCase().includes(n.toLowerCase()))}),F=s=>{g.mutate(s)},I=[{value:"BigHouse",label:"Big House (Multiple members)"},{value:"SmallHouse",label:"Small House (Single member)"}];return z?e.jsx(B,{children:e.jsx(U,{})}):e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Houses"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Manage houses and their members"})]}),e.jsxs(l,{onClick:()=>r(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add House"]})]}),e.jsx(M,{children:e.jsx(E,{className:"p-4",children:e.jsx(x,{placeholder:"Search houses...",value:n,onChange:s=>V(s.target.value),leftIcon:e.jsx(te,{className:"h-5 w-5"})})})}),N.length===0?e.jsx(D,{icon:Y,title:"No Houses Found",description:n?"No houses match your search.":"Start by adding your first house to manage meal orders.",action:!n&&e.jsxs(l,{onClick:()=>r(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add House"]})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(s=>e.jsx(M,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900",children:s.name}),e.jsx(_,{status:s.status||"active"})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.type==="BigHouse"?"bg-primary-100 text-primary-700":"bg-secondary-100 text-secondary-700"}`,children:s.type==="BigHouse"?"Big House":"Small House"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-secondary-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:s.address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.memberCount||0," members"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:s.houseAdminPhone||s.adminPhone||"No admin assigned"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-secondary-100",children:[e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{p(s),r(!0)},children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsx(l,{variant:"outline",size:"sm",className:"text-danger-600 hover:bg-danger-50",onClick:()=>f(s),children:e.jsx(me,{className:"h-4 w-4"})})]})]})},s.id))})]}),e.jsx(ee,{isOpen:q,onClose:()=>{r(!1),p(null),j()},title:a?"Edit House":"Add New House",size:"md",children:e.jsxs("form",{onSubmit:k(F),className:"space-y-4",children:[e.jsx(x,{label:"House Name",placeholder:"Enter house name",error:(S=m.name)==null?void 0:S.message,defaultValue:a==null?void 0:a.name,...o("name")}),e.jsx(ae,{label:"House Type",options:I,error:(v=m.type)==null?void 0:v.message,defaultValue:a==null?void 0:a.type,...o("type")}),e.jsx(re,{label:"Address",placeholder:"Enter complete address",error:(C=m.address)==null?void 0:C.message,defaultValue:a==null?void 0:a.address,...o("address")}),e.jsx(x,{label:"Admin Name",placeholder:"House admin's name",error:(w=m.adminName)==null?void 0:w.message,defaultValue:a==null?void 0:a.adminName,...o("adminName")}),e.jsx(x,{label:"Admin Phone",placeholder:"+91 XXXXX XXXXX",error:(H=m.adminPhone)==null?void 0:H.message,defaultValue:a==null?void 0:a.adminPhone,...o("adminPhone")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(l,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{r(!1),p(null),j()},children:"Cancel"}),e.jsxs(l,{type:"submit",className:"flex-1",isLoading:g.isPending,children:[a?"Update":"Create"," House"]})]})]})}),e.jsx(se,{isOpen:!!i,onClose:()=>f(null),onConfirm:()=>{y.success("House deleted"),f(null)},title:"Delete House",message:`Are you sure you want to delete "${i==null?void 0:i.name}"? This will remove all associated data.`,confirmText:"Delete",variant:"danger"})]})}export{Te as default};
