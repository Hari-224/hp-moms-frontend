import{a as re,e as ne,r as d,j as e,P as ie,M as O,b as le,f as z,z as c}from"./index-B5aJpQwO.js";import{u as B}from"./useQuery-DiLk-DaS.js";import{u as v}from"./useMutation-CDmglRiW.js";import{u as ce}from"./index.esm-BA58FhFx.js";import{t as oe,o as me,s as y}from"./types-7h59Fkfz.js";import{m as u}from"./api-DOR-wefx.js";import{L as Q,C as M,a as I,b as R,c as H}from"./Card-BgyJxnnv.js";import{M as de}from"./Modal-B6DbCECy.js";import{I as C,T as ue,S as xe}from"./Input-DSy_cLET.js";import{c as pe,B as x,C as he}from"./Button-CiOENXfr.js";import{P as K}from"./plus-DsVY0QKG.js";import{C as ye}from"./calendar-CwUE91eJ.js";import{C as je}from"./clock-Ol14wkjx.js";import{L as fe}from"./lock-BbfJ0KVP.js";import{T as ge}from"./trash-2-CLHE8Nky.js";import{S as be}from"./save-DXxxMTj2.js";import"./user-DVTd2ZHA.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=pe("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),ve=me({name:y().min(2,"Name is required"),description:y().optional(),price:y().min(1,"Price is required"),category:y().min(1,"Category is required")});function Ke(){var E,F,A,D,P,q;const{userData:j}=re(),f=ne(),[_,p]=d.useState(!1),[Me,$]=d.useState(null),[Ie,Ce]=d.useState(null),[r,V]=d.useState(new Date().toISOString().split("T")[0]),[t,Y]=d.useState("lunch"),a=j==null?void 0:j.agencyId,{register:h,handleSubmit:G,reset:g,formState:{errors:b}}=ce({resolver:oe(ve)}),{data:N,isLoading:J}=B({queryKey:["menuItems",a],queryFn:()=>u.getItems(a),enabled:!!a}),{data:l,isLoading:U}=B({queryKey:["dailyMenu",a,r],queryFn:()=>u.getDailyMenu(a,r),enabled:!!a}),w=v({mutationFn:s=>u.createItem(a,{...s,price:parseFloat(s.price)}),onSuccess:()=>{c.success("Menu item created!"),p(!1),g(),f.invalidateQueries(["menuItems"])},onError:s=>{c.error(s.message||"Failed to create item")}}),S=v({mutationFn:s=>u.publishDailyMenu(s),onSuccess:()=>{c.success("Daily menu published!"),f.invalidateQueries(["dailyMenu"])},onError:s=>{c.error(s.message||"Failed to publish menu")}}),W=v({mutationFn:({mealType:s})=>u.lockMenu(a,r,s),onSuccess:()=>{c.success("Menu locked!"),f.invalidateQueries(["dailyMenu"])},onError:s=>{c.error(s.message||"Failed to lock menu")}}),X=J||U,Z=((E=N==null?void 0:N.data)==null?void 0:E.items)||[],k=((F=l==null?void 0:l.data)==null?void 0:F.menu)||{},L=((A=l==null?void 0:l.data)==null?void 0:A.cutoffTimes)||{},o=k[t]||[],n=k[`${t}Locked`],T=Z.filter(s=>!o.some(i=>i.id===s.id)),ee=s=>{w.mutate(s)},se=s=>{const i=[...o,s];S.mutate({agencyId:a,date:r,mealType:t,items:i.map(m=>({menuItemId:m.id,available:!0}))})},ae=s=>{const i=o.filter(m=>m.id!==s);S.mutate({agencyId:a,date:r,mealType:t,items:i.map(m=>({menuItemId:m.id,available:!0}))})},te=[{value:"main",label:"Main Course"},{value:"side",label:"Side Dish"},{value:"bread",label:"Bread"},{value:"rice",label:"Rice"},{value:"dessert",label:"Dessert"},{value:"beverage",label:"Beverage"},{value:"snack",label:"Snack"}];return X?e.jsx(Q,{children:e.jsx(ie,{})}):e.jsxs(Q,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Menu Management"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Manage your menu items and daily menus"})]}),e.jsxs(x,{onClick:()=>p(!0),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add Menu Item"]})]}),e.jsx(M,{children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-secondary-400"}),e.jsx(C,{type:"date",value:r,onChange:s=>V(s.target.value),className:"w-40"})]}),e.jsx("div",{className:"flex gap-2",children:Object.entries(O).map(([s,i])=>e.jsx("button",{onClick:()=>Y(s),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t===s?"bg-primary-600 text-white":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200"}`,children:i},s))})]})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsxs(R,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(H,{children:[O[t]," Menu"]}),e.jsx("p",{className:"text-sm text-secondary-500 mt-1",children:le(r,"EEEE, dd MMMM")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L[t]&&e.jsxs("span",{className:"text-sm text-secondary-500 flex items-center gap-1",children:[e.jsx(je,{className:"h-4 w-4"}),"Cutoff: ",L[t]]}),e.jsxs(x,{variant:n?"secondary":"warning",size:"sm",onClick:()=>W.mutate({mealType:t}),disabled:n,children:[n?e.jsx(fe,{className:"h-4 w-4 mr-1"}):e.jsx(Ne,{className:"h-4 w-4 mr-1"}),n?"Locked":"Lock Menu"]})]})]}),e.jsx(I,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-secondary-500",children:[e.jsx(he,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No items in today's menu"}),e.jsx("p",{className:"text-sm",children:"Add items from the catalog"})]}):e.jsx("div",{className:"space-y-2",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary-900",children:s.name}),e.jsx("p",{className:"text-sm text-secondary-500",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-primary-600",children:z(s.price)}),!n&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>ae(s.id),className:"text-danger-600",children:e.jsx(ge,{className:"h-4 w-4"})})]})]},s.id))})})]}),e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"Menu Catalog"}),e.jsx("p",{className:"text-sm text-secondary-500",children:"Click to add items to today's menu"})]}),e.jsx(I,{children:T.length===0?e.jsx("div",{className:"text-center py-8 text-secondary-500",children:e.jsx("p",{children:"All items are in today's menu"})}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T.map(s=>e.jsxs("button",{onClick:()=>!n&&se(s),disabled:n,className:"w-full flex items-center justify-between p-3 bg-secondary-50 rounded-lg hover:bg-secondary-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary-900",children:s.name}),e.jsx("p",{className:"text-sm text-secondary-500",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-primary-600",children:z(s.price)}),e.jsx(K,{className:"h-5 w-5 text-primary-600"})]})]},s.id))})})]})]})]}),e.jsx(de,{isOpen:_,onClose:()=>{p(!1),$(null),g()},title:"Add Menu Item",size:"md",children:e.jsxs("form",{onSubmit:G(ee),className:"space-y-4",children:[e.jsx(C,{label:"Item Name",placeholder:"Enter item name",error:(D=b.name)==null?void 0:D.message,...h("name")}),e.jsx(ue,{label:"Description (Optional)",placeholder:"Describe the item",...h("description")}),e.jsx(C,{label:"Price (â‚¹)",type:"number",step:"0.01",placeholder:"Enter price",error:(P=b.price)==null?void 0:P.message,...h("price")}),e.jsx(xe,{label:"Category",options:te,error:(q=b.category)==null?void 0:q.message,...h("category")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{p(!1),g()},children:"Cancel"}),e.jsxs(x,{type:"submit",className:"flex-1",isLoading:w.isPending,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Save Item"]})]})]})})]})}export{Ke as default};
