import{a as T,e as $,r as p,j as e,P as Q,b as l,f as r,i as Y,z as n,k as _,s as H,l as V,m as W}from"./index-B5aJpQwO.js";import{u as G}from"./useQuery-DiLk-DaS.js";import{u as K}from"./useMutation-CDmglRiW.js";import{u as X}from"./index.esm-BA58FhFx.js";import{p as J,b as Z}from"./api-DOR-wefx.js";import{L as I,R as ee,C as se,a as ae,X as te}from"./Card-BgyJxnnv.js";import{S as re}from"./Badge-Bb7NU6h0.js";import{E as ne}from"./EmptyState-idfWPYnV.js";import{M as k}from"./Modal-B6DbCECy.js";import{I as M,S as oe,T as le}from"./Input-DSy_cLET.js";import{c as ie,B as m}from"./Button-CiOENXfr.js";import{C as ce}from"./calendar-CwUE91eJ.js";import{E as de}from"./eye-BawcbnTh.js";import{I as D}from"./indian-rupee-BiIBptTw.js";import{C as me}from"./check-CZ9WrWSr.js";import"./user-DVTd2ZHA.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ie("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Ee(){var P,S,A,C;const{userData:R}=T(),L=$(),[a,x]=p.useState(null),[N,i]=p.useState(!1),[h,g]=p.useState(!1),[c,d]=p.useState(""),{register:u,handleSubmit:U,reset:y,formState:{errors:b}}=X(),{data:f,isLoading:z}=G({queryKey:["myBills"],queryFn:()=>Z.getMyBills({})}),v=K({mutationFn:s=>J.record(s),onSuccess:()=>{n.success("Payment recorded! Waiting for confirmation."),i(!1),x(null),d(""),y(),L.invalidateQueries(["myBills"])},onError:s=>{n.error(s.message||"Failed to record payment")}}),w=((P=f==null?void 0:f.data)==null?void 0:P.bills)||[],F=async s=>{var B;const t=(B=s.target.files)==null?void 0:B[0];if(t){if(!t.type.startsWith("image/")){n.error("Please upload an image file");return}if(t.size>5*1024*1024){n.error("File size must be less than 5MB");return}g(!0);try{const j=`payments/${R.id}/${Date.now()}_${t.name}`,E=_(H,j);await V(E,t);const O=await W(E);d(O),n.success("Screenshot uploaded successfully")}catch(j){console.error("Upload error:",j),n.error("Failed to upload screenshot")}finally{g(!1)}}},q=s=>{if(!c){n.error("Please upload a payment screenshot");return}v.mutate({billId:a.id,amount:parseFloat(s.amount),method:s.method,transactionId:s.transactionId||"",screenshotUrl:c,notes:s.notes||""})},o=s=>s.totalAmount-(s.paidAmount||0);return z?e.jsx(I,{children:e.jsx(Q,{})}):e.jsxs(I,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"My Bills"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"View and pay your bills"})]}),w.length===0?e.jsx(ne,{icon:ee,title:"No Bills Yet",description:"You don't have any bills. Start ordering to see your bills here!"}):e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsx(se,{children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ce,{className:"h-5 w-5 text-secondary-400"}),e.jsxs("span",{className:"font-medium text-secondary-900",children:[l(s.periodStart)," - ",l(s.periodEnd)]}),e.jsx(re,{status:s.status})]}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[s.itemCount||0," orders • Generated on ",l(s.createdAt)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-secondary-900",children:r(s.totalAmount)}),s.paidAmount>0&&s.status!=="paid"&&e.jsxs("p",{className:"text-sm text-secondary-500",children:["Paid: ",r(s.paidAmount)," |",e.jsxs("span",{className:"text-danger-600 font-medium",children:[" ","Due: ",r(o(s))]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>x(s),children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Details"]}),s.status!=="paid"&&e.jsxs(m,{size:"sm",onClick:()=>{x(s),i(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Pay Now"]})]})]})})},s.id))})]}),e.jsx(k,{isOpen:a&&!N,onClose:()=>x(null),title:"Bill Details",size:"lg",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Period"}),e.jsxs("span",{className:"font-medium text-secondary-900",children:[l(a.periodStart)," - ",l(a.periodEnd)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-secondary-900 mb-2",children:"Order Items"}),e.jsx("div",{className:"bg-secondary-50 rounded-lg p-3 space-y-2 max-h-60 overflow-y-auto",children:(S=a.items)==null?void 0:S.map((s,t)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-secondary-600",children:[s.name," × ",s.quantity," (",l(s.date),")"]}),e.jsx("span",{className:"text-secondary-900",children:r(s.total)})]},t))})]}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-secondary-200",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-500",children:"Total Amount"}),e.jsx("span",{className:"font-bold text-secondary-900",children:r(a.totalAmount)})]}),a.paidAmount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-500",children:"Paid Amount"}),e.jsx("span",{className:"text-success-600",children:r(a.paidAmount)})]}),a.status!=="paid"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-500",children:"Remaining"}),e.jsx("span",{className:"font-bold text-danger-600",children:r(o(a))})]})]}),a.status!=="paid"&&e.jsxs(m,{className:"w-full",onClick:()=>i(!0),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})}),e.jsx(k,{isOpen:N,onClose:()=>{i(!1),d(""),y()},title:"Record Payment",size:"md",children:a&&e.jsxs("form",{onSubmit:U(q),className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-primary-600",children:"Amount Due"}),e.jsx("p",{className:"text-2xl font-bold text-primary-700",children:r(o(a))})]}),e.jsx(M,{label:"Payment Amount",type:"number",step:"0.01",placeholder:"Enter amount",defaultValue:o(a),error:(A=b.amount)==null?void 0:A.message,...u("amount",{required:"Amount is required",min:{value:1,message:"Amount must be at least ₹1"},max:{value:o(a),message:`Amount cannot exceed ₹${o(a)}`}})}),e.jsx(oe,{label:"Payment Method",options:Object.entries(Y).map(([s,t])=>({value:s,label:t})),error:(C=b.method)==null?void 0:C.message,...u("method",{required:"Please select a payment method"})}),e.jsx(M,{label:"Transaction ID / Reference (Optional)",placeholder:"Enter UPI reference or transaction ID",...u("transactionId")}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-secondary-700 mb-1.5",children:["Payment Screenshot ",e.jsx("span",{className:"text-danger-500",children:"*"})]}),c?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c,alt:"Payment screenshot",className:"w-full h-48 object-contain bg-secondary-100 rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>d(""),className:"absolute top-2 right-2 p-1 bg-white rounded-full shadow-md",children:e.jsx(te,{className:"h-4 w-4 text-danger-600"})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-secondary-300 rounded-lg cursor-pointer hover:border-primary-500 transition-colors",children:[e.jsx("div",{className:"flex flex-col items-center",children:h?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-8 w-8 text-secondary-400 mb-2"}),e.jsx("p",{className:"text-sm text-secondary-500",children:"Click to upload payment screenshot"})]})}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:F,disabled:h})]})]}),e.jsx(le,{label:"Notes (Optional)",placeholder:"Any additional notes...",rows:2,...u("notes")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(m,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{i(!1),d(""),y()},children:"Cancel"}),e.jsxs(m,{type:"submit",className:"flex-1",isLoading:v.isPending,disabled:!c||h,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Submit Payment"]})]})]})})]})}export{Ee as default};
