import{a as F,e as L,r as u,j as e,P as q,f as l,b as i,z as y}from"./index-Bz7pwbB9.js";import{u as H}from"./useQuery-BBL-UJvn.js";import{u as O}from"./useMutation-bJ9c7Hmc.js";import{b as B}from"./api-Bp1mAEYF.js";import{L as C,C as d,a as c,R,B as T}from"./Card-D8tmHTuL.js";import{S as A}from"./Badge-DsqiXPr3.js";import{E as Q}from"./EmptyState-BtxfN_BO.js";import{M as w}from"./Modal-CfOO-JW_.js";import{S as D,I as E}from"./Input-DkrhA-KG.js";import{B as o}from"./Button-DxGI9h4D.js";import{P}from"./plus-D4MauG9m.js";import{E as K}from"./eye-Crd8dv1B.js";import"./user-BIVSRI51.js";function le(){var S,b;const{userData:p}=F(),I=L(),[G,r]=u.useState(!1),[a,g]=u.useState(null),[h,k]=u.useState(""),[t,x]=u.useState({houseId:"",periodStart:"",periodEnd:""}),m=p==null?void 0:p.agencyId,{data:j,isLoading:M}=H({queryKey:["agencyBills",m,h],queryFn:()=>B.getAgencyBills(m,{status:h||void 0}),enabled:!!m}),v=O({mutationFn:s=>B.generate(s),onSuccess:()=>{y.success("Bill generated successfully!"),r(!1),x({houseId:"",periodStart:"",periodEnd:""}),I.invalidateQueries(["agencyBills"])},onError:s=>{y.error(s.message||"Failed to generate bill")}}),N=((S=j==null?void 0:j.data)==null?void 0:S.bills)||[],f=N.reduce((s,n)=>(s.total+=n.totalAmount||0,s.paid+=n.paidAmount||0,s.pending+=(n.totalAmount||0)-(n.paidAmount||0),s),{total:0,paid:0,pending:0}),z=()=>{if(!t.houseId||!t.periodStart||!t.periodEnd){y.error("Please fill all fields");return}v.mutate({agencyId:m,...t})};return M?e.jsx(C,{children:e.jsx(q,{})}):e.jsxs(C,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Bills"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Generate and manage house bills"})]}),e.jsxs(o,{onClick:()=>r(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Generate Bill"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(d,{children:e.jsxs(c,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total Billed"}),e.jsx("p",{className:"text-2xl font-bold text-secondary-900",children:l(f.total)})]})}),e.jsx(d,{children:e.jsxs(c,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Collected"}),e.jsx("p",{className:"text-2xl font-bold text-success-600",children:l(f.paid)})]})}),e.jsx(d,{children:e.jsxs(c,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-danger-600",children:l(f.pending)})]})})]}),e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsx("div",{className:"flex gap-4",children:e.jsxs("select",{value:h,onChange:s=>k(s.target.value),className:"input w-40",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})})})}),N.length===0?e.jsx(Q,{icon:R,title:"No Bills Found",description:"Generate your first bill to start tracking payments",action:e.jsxs(o,{onClick:()=>r(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Generate Bill"]})}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsx(d,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-50 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900",children:s.houseName}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[i(s.periodStart)," - ",i(s.periodEnd)]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-secondary-900",children:l(s.totalAmount)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Paid"}),e.jsx("p",{className:"text-lg font-semibold text-success-600",children:l(s.paidAmount||0)})]}),e.jsx(A,{status:s.status}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>g(s),children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"View"]})]})]})})},s.id))})]}),e.jsx(w,{isOpen:G,onClose:()=>r(!1),title:"Generate Bill",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(D,{label:"Select House",options:[{value:"house1",label:"Sample House 1"},{value:"house2",label:"Sample House 2"}],value:t.houseId,onChange:s=>x({...t,houseId:s.target.value})}),e.jsx(E,{label:"Period Start",type:"date",value:t.periodStart,onChange:s=>x({...t,periodStart:s.target.value})}),e.jsx(E,{label:"Period End",type:"date",value:t.periodEnd,onChange:s=>x({...t,periodEnd:s.target.value})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(o,{variant:"secondary",className:"flex-1",onClick:()=>r(!1),children:"Cancel"}),e.jsx(o,{className:"flex-1",onClick:z,isLoading:v.isPending,children:"Generate Bill"})]})]})}),e.jsx(w,{isOpen:!!a,onClose:()=>g(null),title:"Bill Details",size:"lg",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"House"}),e.jsx("p",{className:"font-medium text-secondary-900",children:a.houseName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Period"}),e.jsxs("p",{className:"font-medium text-secondary-900",children:[i(a.periodStart)," - ",i(a.periodEnd)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total Amount"}),e.jsx("p",{className:"font-bold text-xl text-secondary-900",children:l(a.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Status"}),e.jsx(A,{status:a.status})]})]}),e.jsxs("div",{className:"border-t border-secondary-200 pt-4",children:[e.jsx("h4",{className:"font-medium text-secondary-900 mb-3",children:"Order Items"}),e.jsx("div",{className:"bg-secondary-50 rounded-lg p-3 max-h-60 overflow-y-auto",children:((b=a.items)==null?void 0:b.map((s,n)=>e.jsxs("div",{className:"flex justify-between py-2 text-sm",children:[e.jsxs("span",{className:"text-secondary-600",children:[s.name," Ã— ",s.quantity," (",i(s.date),")"]}),e.jsx("span",{className:"font-medium text-secondary-900",children:l(s.total)})]},n)))||e.jsx("p",{className:"text-secondary-500",children:"No items"})})]}),e.jsxs("div",{className:"border-t border-secondary-200 pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-500",children:"Total Amount"}),e.jsx("span",{className:"font-semibold",children:l(a.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-secondary-500",children:"Paid Amount"}),e.jsx("span",{className:"text-success-600",children:l(a.paidAmount||0)})]}),e.jsxs("div",{className:"flex justify-between text-lg",children:[e.jsx("span",{className:"font-medium",children:"Remaining"}),e.jsx("span",{className:"font-bold text-danger-600",children:l((a.totalAmount||0)-(a.paidAmount||0))})]})]})]})})]})}export{le as default};
