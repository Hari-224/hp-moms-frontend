import{a as Q,e as U,r as m,j as e,P as q,f as x,i as P,h as S,z as h}from"./index-Bz7pwbB9.js";import{u as O}from"./useQuery-BBL-UJvn.js";import{u as A}from"./useMutation-bJ9c7Hmc.js";import{p as b}from"./api-Bp1mAEYF.js";import{L as E,C as j,a as p,f as I,X as R}from"./Card-D8tmHTuL.js";import{S as k}from"./Badge-DsqiXPr3.js";import{E as D}from"./EmptyState-BtxfN_BO.js";import{M as L}from"./Modal-CfOO-JW_.js";import{T as H}from"./Input-DkrhA-KG.js";import{B as n}from"./Button-DxGI9h4D.js";import{I as _}from"./indian-rupee-CKO2li8T.js";import{I as K}from"./image-Bp3tbxms.js";import{C as M}from"./check-BZlzTsAS.js";import{E as X}from"./eye-Crd8dv1B.js";import"./user-BIVSRI51.js";function le(){var C;const{userData:u}=Q(),y=U(),[a,t]=m.useState(null),[r,c]=m.useState(null),[v,i]=m.useState(""),[l,z]=m.useState("pending"),N=u==null?void 0:u.agencyId,{data:f,isLoading:F}=O({queryKey:["agencyPayments",N,l],queryFn:()=>b.getAgencyPayments(N,{status:l||void 0}),enabled:!!N}),d=A({mutationFn:s=>b.confirm(s),onSuccess:()=>{h.success("Payment confirmed!"),t(null),y.invalidateQueries(["agencyPayments"]),y.invalidateQueries(["agencyBills"])},onError:s=>{h.error(s.message||"Failed to confirm payment")}}),w=A({mutationFn:({paymentId:s,reason:g})=>b.reject(s,g),onSuccess:()=>{h.success("Payment rejected"),c(null),i(""),y.invalidateQueries(["agencyPayments"])},onError:s=>{h.error(s.message||"Failed to reject payment")}}),o=((C=f==null?void 0:f.data)==null?void 0:C.payments)||[],T=o.filter(s=>s.status==="pending").length,B=o.filter(s=>s.status==="pending").reduce((s,g)=>s+g.amount,0);return F?e.jsx(E,{children:e.jsx(q,{})}):e.jsxs(E,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Payments"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Review and confirm payment submissions"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{className:"bg-warning-50 border-warning-200",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-warning-100 rounded-lg",children:e.jsx(I,{className:"h-6 w-6 text-warning-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-warning-700",children:"Pending Approvals"}),e.jsx("p",{className:"text-2xl font-bold text-warning-900",children:T})]})]})})}),e.jsx(j,{className:"bg-primary-50 border-primary-200",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(_,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary-700",children:"Pending Amount"}),e.jsx("p",{className:"text-2xl font-bold text-primary-900",children:x(B)})]})]})})})]}),e.jsx(j,{children:e.jsx(p,{className:"p-4",children:e.jsx("div",{className:"flex gap-2",children:["pending","confirmed","rejected",""].map(s=>e.jsx("button",{onClick:()=>z(s),className:`px-4 py-2 rounded-lg font-medium transition-colors ${l===s?"bg-primary-600 text-white":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200"}`,children:s===""?"All":s.charAt(0).toUpperCase()+s.slice(1)},s))})})}),o.length===0?e.jsx(D,{icon:I,title:"No Payments Found",description:l==="pending"?"No pending payments to review":"No payments match the selected filter"}):e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsx(j,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.screenshotUrl?e.jsx("img",{src:s.screenshotUrl,alt:"Payment screenshot",className:"w-16 h-16 object-cover rounded-lg cursor-pointer",onClick:()=>t(s)}):e.jsx("div",{className:"w-16 h-16 bg-secondary-100 rounded-lg flex items-center justify-center",children:e.jsx(K,{className:"h-6 w-6 text-secondary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900",children:s.houseName}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[P[s.method]," â€¢ ",S(s.createdAt)]}),s.transactionId&&e.jsxs("p",{className:"text-xs text-secondary-400",children:["Ref: ",s.transactionId]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-2xl font-bold text-secondary-900",children:x(s.amount)})}),e.jsx(k,{status:s.status}),s.status==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"danger",size:"sm",onClick:()=>c(s),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(n,{variant:"success",size:"sm",onClick:()=>d.mutate(s.id),isLoading:d.isPending,children:e.jsx(M,{className:"h-4 w-4"})})]}):e.jsx(n,{variant:"outline",size:"sm",onClick:()=>t(s),children:e.jsx(X,{className:"h-4 w-4"})})]})]})})},s.id))})]}),e.jsx(L,{isOpen:!!a,onClose:()=>t(null),title:"Payment Details",size:"md",children:a&&e.jsxs("div",{className:"space-y-4",children:[a.screenshotUrl&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary-500 mb-2",children:"Payment Screenshot"}),e.jsx("img",{src:a.screenshotUrl,alt:"Payment screenshot",className:"w-full rounded-lg"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"House"}),e.jsx("span",{className:"font-medium",children:a.houseName})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Amount"}),e.jsx("span",{className:"font-bold text-primary-600",children:x(a.amount)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Method"}),e.jsx("span",{children:P[a.method]})]}),a.transactionId&&e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Transaction ID"}),e.jsx("span",{className:"font-mono",children:a.transactionId})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Status"}),e.jsx(k,{status:a.status})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-secondary-100",children:[e.jsx("span",{className:"text-secondary-500",children:"Submitted"}),e.jsx("span",{children:S(a.createdAt)})]}),a.notes&&e.jsxs("div",{className:"py-2",children:[e.jsx("p",{className:"text-secondary-500 text-sm",children:"Notes"}),e.jsx("p",{className:"text-secondary-700",children:a.notes})]})]}),a.status==="pending"&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(n,{variant:"danger",className:"flex-1",onClick:()=>{c(a),t(null)},children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Reject"]}),e.jsxs(n,{variant:"success",className:"flex-1",onClick:()=>{d.mutate(a.id)},isLoading:d.isPending,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Confirm"]})]})]})}),e.jsx(L,{isOpen:!!r,onClose:()=>{c(null),i("")},title:"Reject Payment",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-secondary-600",children:["Are you sure you want to reject this payment of"," ",e.jsx("span",{className:"font-semibold",children:x((r==null?void 0:r.amount)||0)}),"?"]}),e.jsx(H,{label:"Reason for rejection",placeholder:"Enter reason...",value:v,onChange:s=>i(s.target.value),rows:3}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{variant:"secondary",className:"flex-1",onClick:()=>{c(null),i("")},children:"Cancel"}),e.jsx(n,{variant:"danger",className:"flex-1",onClick:()=>w.mutate({paymentId:r.id,reason:v}),isLoading:w.isPending,children:"Reject Payment"})]})]})})]})}export{le as default};
