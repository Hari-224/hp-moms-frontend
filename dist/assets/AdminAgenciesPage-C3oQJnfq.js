import{a as G,e as J,r as N,j as e,P as W,z as t}from"./index-Bz7pwbB9.js";import{u as Y}from"./useQuery-BBL-UJvn.js";import{u as y}from"./useMutation-bJ9c7Hmc.js";import{u as Z}from"./index.esm-nOunc93L.js";import{t as _,o as ee,s as w}from"./types-2AX18-p6.js";import{c as u}from"./api-Bp1mAEYF.js";import{L as q,C as i,a as c,B as z,U as B}from"./Card-D8tmHTuL.js";import{B as O,S as se}from"./Badge-DsqiXPr3.js";import{E as ae}from"./EmptyState-BtxfN_BO.js";import{M as te,C as re}from"./Modal-CfOO-JW_.js";import{I as v,T as ne}from"./Input-DkrhA-KG.js";import{c as I,B as n}from"./Button-DxGI9h4D.js";import{P as Q}from"./plus-D4MauG9m.js";import{S as ie}from"./search-o6vBxrYE.js";import{P as ce}from"./phone-CAzyxAd7.js";import{M as oe,S as le}from"./square-pen-GRf-veb6.js";import{T as de}from"./trash-2-BcqysFBi.js";import"./user-BIVSRI51.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=I("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),ue=ee({name:w().min(2,"Name is required"),ownerName:w().min(2,"Owner name is required"),ownerPhone:w().min(10,"Valid phone required"),address:w().min(5,"Address is required")});function ke(){var M,E,L,F,k;const{userData:he}=G(),h=J(),[D,o]=N.useState(!1),[l,p]=N.useState(null),[r,A]=N.useState(null),[d,R]=N.useState(""),{register:g,handleSubmit:U,reset:m,formState:{errors:j}}=Z({resolver:_(ue)}),{data:b,isLoading:H}=Y({queryKey:["adminAgencies"],queryFn:()=>u.getAllAgencies()}),C=y({mutationFn:s=>u.createAgency(s),onSuccess:()=>{t.success("Agency created successfully!"),o(!1),m(),h.invalidateQueries(["adminAgencies"])},onError:s=>{t.error(s.message||"Failed to create agency")}}),S=y({mutationFn:({id:s,data:a})=>u.updateAgency(s,a),onSuccess:()=>{t.success("Agency updated!"),p(null),m(),h.invalidateQueries(["adminAgencies"])},onError:s=>{t.error(s.message||"Failed to update agency")}}),K=y({mutationFn:({id:s,status:a})=>u.updateAgencyStatus(s,a),onSuccess:()=>{t.success("Agency status updated!"),h.invalidateQueries(["adminAgencies"])},onError:s=>{t.error(s.message||"Failed to update status")}}),P=y({mutationFn:s=>u.deleteAgency(s),onSuccess:()=>{t.success("Agency deleted"),A(null),h.invalidateQueries(["adminAgencies"])},onError:s=>{t.error(s.message||"Failed to delete agency")}}),x=((M=b==null?void 0:b.data)==null?void 0:M.agencies)||[],T=x.filter(s=>{var a,X;return((a=s.name)==null?void 0:a.toLowerCase().includes(d.toLowerCase()))||((X=s.ownerName)==null?void 0:X.toLowerCase().includes(d.toLowerCase()))}),f={total:x.length,active:x.filter(s=>s.status==="active").length,houses:x.reduce((s,a)=>s+(a.housesCount||0),0),members:x.reduce((s,a)=>s+(a.membersCount||0),0)},V=s=>{l?S.mutate({id:l.id,data:s}):C.mutate(s)},$=s=>{p(s),m({name:s.name,ownerName:s.ownerName,ownerPhone:s.ownerPhone,address:s.address})};return H?e.jsx(q,{children:e.jsx(W,{})}):e.jsxs(q,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Food Agencies"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Manage all food agencies in the system"})]}),e.jsxs(n,{onClick:()=>o(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Agency"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total Agencies"}),e.jsx("p",{className:"text-2xl font-bold text-secondary-900",children:f.total})]})}),e.jsx(i,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-success-600",children:f.active})]})}),e.jsx(i,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total Houses"}),e.jsx("p",{className:"text-2xl font-bold text-primary-600",children:f.houses})]})}),e.jsx(i,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-sm text-secondary-500",children:"Total Members"}),e.jsx("p",{className:"text-2xl font-bold text-primary-600",children:f.members})]})})]}),e.jsx(i,{children:e.jsx(c,{className:"p-4",children:e.jsx(v,{placeholder:"Search agencies...",value:d,onChange:s=>R(s.target.value),leftIcon:e.jsx(ie,{className:"h-5 w-5"})})})}),T.length===0?e.jsx(ae,{icon:z,title:"No Agencies Found",description:d?"No agencies match your search":"Add food agencies to get started",action:!d&&e.jsxs(n,{onClick:()=>o(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Add Agency"]})}):e.jsx("div",{className:"space-y-4",children:T.map(s=>{var a;return e.jsx(i,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-50 rounded-lg",children:e.jsx(z,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900 text-lg",children:s.name}),e.jsxs("p",{className:"text-sm text-secondary-600",children:["Owner: ",s.ownerName]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-secondary-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-4 w-4"}),s.ownerPhone]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4"}),(a=s.address)==null?void 0:a.substring(0,30),"..."]})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs(O,{variant:"secondary",size:"sm",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),s.housesCount||0," Houses"]}),e.jsxs(O,{variant:"secondary",size:"sm",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),s.membersCount||0," Members"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{status:s.status||"active"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>K.mutate({id:s.id,status:s.status==="active"?"inactive":"active"}),children:s.status==="active"?e.jsx(xe,{className:"h-6 w-6 text-success-600"}):e.jsx(me,{className:"h-6 w-6 text-secondary-400"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>$(s),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",className:"text-danger-600 hover:bg-danger-50",onClick:()=>A(s),children:e.jsx(de,{className:"h-4 w-4"})})]})]})})},s.id)})})]}),e.jsx(te,{isOpen:D||!!l,onClose:()=>{o(!1),p(null),m()},title:l?"Edit Agency":"Add Agency",size:"md",children:e.jsxs("form",{onSubmit:U(V),className:"space-y-4",children:[e.jsx(v,{label:"Agency Name",placeholder:"Enter agency name",error:(E=j.name)==null?void 0:E.message,...g("name")}),e.jsx(v,{label:"Owner Name",placeholder:"Enter owner's name",error:(L=j.ownerName)==null?void 0:L.message,...g("ownerName")}),e.jsx(v,{label:"Owner Phone",placeholder:"+91 XXXXX XXXXX",error:(F=j.ownerPhone)==null?void 0:F.message,...g("ownerPhone")}),e.jsx(ne,{label:"Address",placeholder:"Enter complete address",error:(k=j.address)==null?void 0:k.message,...g("address")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(n,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{o(!1),p(null),m()},children:"Cancel"}),e.jsx(n,{type:"submit",className:"flex-1",isLoading:C.isPending||S.isPending,children:l?"Update":"Create"})]})]})}),e.jsx(re,{isOpen:!!r,onClose:()=>A(null),onConfirm:()=>P.mutate(r==null?void 0:r.id),title:"Delete Agency",message:`Are you sure you want to delete "${r==null?void 0:r.name}"? This will also delete all associated houses, members, orders, and bills.`,confirmText:"Delete",variant:"danger",isLoading:P.isPending})]})}export{ke as default};
