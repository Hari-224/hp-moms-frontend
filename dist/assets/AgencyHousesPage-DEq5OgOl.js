import{a as O,e as Q,r as u,j as e,P as U,z as N}from"./index-B5aJpQwO.js";import{u as $}from"./useQuery-DiLk-DaS.js";import{u as D}from"./useMutation-CDmglRiW.js";import{u as K}from"./index.esm-BA58FhFx.js";import{t as R,o as G,s as x,e as J}from"./types-7h59Fkfz.js";import{h as A}from"./api-DOR-wefx.js";import{L as B,C as M,a as E,B as W,U as Y}from"./Card-BgyJxnnv.js";import{S as Z}from"./Badge-Bb7NU6h0.js";import{E as _}from"./EmptyState-idfWPYnV.js";import{M as ee,C as se}from"./Modal-B6DbCECy.js";import{I as h,S as ae,T as re}from"./Input-DSy_cLET.js";import{B as t}from"./Button-CiOENXfr.js";import{P as X}from"./plus-DsVY0QKG.js";import{S as te}from"./search-DCZalx11.js";import{M as le,S as oe}from"./square-pen-EL8dCp3t.js";import{P as ne}from"./phone-BAkRmmYQ.js";import{T as me}from"./trash-2-CLHE8Nky.js";import"./user-DVTd2ZHA.js";const ie=G({name:x().min(2,"Name must be at least 2 characters"),type:J(["BigHouse","SmallHouse"]),address:x().min(5,"Address must be at least 5 characters"),adminName:x().min(2,"Admin name is required"),adminPhone:x().min(10,"Valid phone number is required")});function Ae(){var v,C,w,H,P,T;const{userData:p}=O(),L=Q(),[q,r]=u.useState(!1),[a,f]=u.useState(null),[c,j]=u.useState(null),[l,V]=u.useState(""),d=p==null?void 0:p.agencyId,{register:o,handleSubmit:k,reset:y,formState:{errors:n}}=K({resolver:R(ie)}),{data:g,isLoading:z}=$({queryKey:["agencyHouses",d],queryFn:async()=>{var m,i;return await((i=(m=A).list)==null?void 0:i.call(m,d))||{data:{houses:[]}}},enabled:!!d}),b=D({mutationFn:s=>A.create({...s,agencyId:d}),onSuccess:()=>{N.success("House created successfully!"),r(!1),y(),L.invalidateQueries(["agencyHouses"])},onError:s=>{N.error(s.message||"Failed to create house")}}),S=(((v=g==null?void 0:g.data)==null?void 0:v.houses)||[]).filter(s=>{var m,i;return((m=s.name)==null?void 0:m.toLowerCase().includes(l.toLowerCase()))||((i=s.address)==null?void 0:i.toLowerCase().includes(l.toLowerCase()))}),F=s=>{b.mutate(s)},I=[{value:"BigHouse",label:"Big House (Multiple members)"},{value:"SmallHouse",label:"Small House (Single member)"}];return z?e.jsx(B,{children:e.jsx(U,{})}):e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Houses"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Manage houses and their members"})]}),e.jsxs(t,{onClick:()=>r(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add House"]})]}),e.jsx(M,{children:e.jsx(E,{className:"p-4",children:e.jsx(h,{placeholder:"Search houses...",value:l,onChange:s=>V(s.target.value),leftIcon:e.jsx(te,{className:"h-5 w-5"})})})}),S.length===0?e.jsx(_,{icon:W,title:"No Houses Found",description:l?"No houses match your search.":"Start by adding your first house to manage meal orders.",action:!l&&e.jsxs(t,{onClick:()=>r(!0),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add House"]})}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(s=>e.jsx(M,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900",children:s.name}),e.jsx(Z,{status:s.status||"active"})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.type==="BigHouse"?"bg-primary-100 text-primary-700":"bg-secondary-100 text-secondary-700"}`,children:s.type==="BigHouse"?"Big House":"Small House"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-secondary-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:s.address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.memberCount||0," members"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:s.adminPhone})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t border-secondary-100",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{f(s),r(!0)},children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsx(t,{variant:"outline",size:"sm",className:"text-danger-600 hover:bg-danger-50",onClick:()=>j(s),children:e.jsx(me,{className:"h-4 w-4"})})]})]})},s.id))})]}),e.jsx(ee,{isOpen:q,onClose:()=>{r(!1),f(null),y()},title:a?"Edit House":"Add New House",size:"md",children:e.jsxs("form",{onSubmit:k(F),className:"space-y-4",children:[e.jsx(h,{label:"House Name",placeholder:"Enter house name",error:(C=n.name)==null?void 0:C.message,defaultValue:a==null?void 0:a.name,...o("name")}),e.jsx(ae,{label:"House Type",options:I,error:(w=n.type)==null?void 0:w.message,defaultValue:a==null?void 0:a.type,...o("type")}),e.jsx(re,{label:"Address",placeholder:"Enter complete address",error:(H=n.address)==null?void 0:H.message,defaultValue:a==null?void 0:a.address,...o("address")}),e.jsx(h,{label:"Admin Name",placeholder:"House admin's name",error:(P=n.adminName)==null?void 0:P.message,defaultValue:a==null?void 0:a.adminName,...o("adminName")}),e.jsx(h,{label:"Admin Phone",placeholder:"+91 XXXXX XXXXX",error:(T=n.adminPhone)==null?void 0:T.message,defaultValue:a==null?void 0:a.adminPhone,...o("adminPhone")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(t,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{r(!1),f(null),y()},children:"Cancel"}),e.jsxs(t,{type:"submit",className:"flex-1",isLoading:b.isPending,children:[a?"Update":"Create"," House"]})]})]})}),e.jsx(se,{isOpen:!!c,onClose:()=>j(null),onConfirm:()=>{N.success("House deleted"),j(null)},title:"Delete House",message:`Are you sure you want to delete "${c==null?void 0:c.name}"? This will remove all associated data.`,confirmText:"Delete",variant:"danger"})]})}export{Ae as default};
