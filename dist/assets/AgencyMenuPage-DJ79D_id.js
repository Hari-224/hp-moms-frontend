import{a as me,e as de,r as p,j as e,P as ue,M as z,b as xe,f as B,z as n}from"./index-Bz7pwbB9.js";import{u as R}from"./useQuery-BBL-UJvn.js";import{u as h}from"./useMutation-bJ9c7Hmc.js";import{u as pe}from"./index.esm-nOunc93L.js";import{t as he,o as ye,s as g}from"./types-2AX18-p6.js";import{m as o}from"./api-Bp1mAEYF.js";import{L as $,C,a as k,b as H,c as K}from"./Card-D8tmHTuL.js";import{M as je}from"./Modal-CfOO-JW_.js";import{I as w,T as ge,S as fe}from"./Input-DkrhA-KG.js";import{c as be,B as x,C as _}from"./Button-DxGI9h4D.js";import{P as U}from"./plus-D4MauG9m.js";import{C as Ne}from"./calendar-CsXTWoLB.js";import{C as ve}from"./clock-A7at3eyY.js";import{L as Me}from"./lock-BQ76QzjE.js";import{T as V}from"./trash-2-BcqysFBi.js";import{C as Ie}from"./check-BZlzTsAS.js";import{S as Ce}from"./save-ZjkWYs49.js";import"./user-BIVSRI51.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=be("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),we=ye({name:g().min(2,"Name is required"),description:g().optional(),price:g().min(1,"Price is required"),category:g().min(1,"Category is required")});function Ge(){var D,P,A,q,Q,O;const{userData:f}=me(),m=de(),[Y,y]=p.useState(!1),[Se,G]=p.useState(null),[Le,Te]=p.useState(null),[l,J]=p.useState(new Date().toISOString().split("T")[0]),[r,W]=p.useState("lunch"),a=f==null?void 0:f.agencyId,{register:j,handleSubmit:X,reset:b,formState:{errors:N}}=pe({resolver:he(we)}),{data:v,isLoading:Z}=R({queryKey:["menuItems",a],queryFn:()=>o.getItems(a),enabled:!!a}),{data:d,isLoading:ee}=R({queryKey:["dailyMenu",a,l],queryFn:()=>o.getDailyMenu(a,l),enabled:!!a}),S=h({mutationFn:s=>o.createItem(a,{...s,price:parseFloat(s.price)}),onSuccess:()=>{n.success("Menu item created!"),y(!1),b(),m.invalidateQueries(["menuItems"])},onError:s=>{n.error(s.message||"Failed to create item")}}),se=h({mutationFn:s=>o.deleteItem(s),onSuccess:()=>{n.success("Menu item deleted!"),m.invalidateQueries(["menuItems"]),m.invalidateQueries(["dailyMenu"])},onError:s=>{n.error(s.message||"Failed to delete item")}}),L=h({mutationFn:s=>o.publishDailyMenu(s),onSuccess:()=>{n.success("Menu updated!"),m.invalidateQueries(["dailyMenu"])},onError:s=>{n.error(s.message||"Failed to update menu")}}),ae=h({mutationFn:({mealType:s})=>o.lockMenu(a,l,s),onSuccess:()=>{n.success("Menu locked!"),m.invalidateQueries(["dailyMenu"])},onError:s=>{n.error(s.message||"Failed to lock menu")}}),te=h({mutationFn:({mealType:s})=>o.unlockMenu(a,l,s),onSuccess:()=>{n.success("Menu unlocked!"),m.invalidateQueries(["dailyMenu"])},onError:s=>{n.error(s.message||"Failed to unlock menu")}}),ne=Z||ee,T=((D=v==null?void 0:v.data)==null?void 0:D.items)||[],re=((P=d==null?void 0:d.data)==null?void 0:P.menus)||{},E=((A=d==null?void 0:d.data)==null?void 0:A.cutoffTimes)||{},u=re[r],c=(u==null?void 0:u.items)||[],M=(u==null?void 0:u.locked)||!1,F=s=>c.some(t=>t.id===s),ie=s=>{S.mutate(s)},le=s=>{const t=F(s.id);let i;t?i=c.filter(I=>I.id!==s.id):i=[...c,{id:s.id,name:s.name,price:s.price,category:s.category}],L.mutate({agencyId:a,date:l,mealType:r,items:i.map(I=>({id:I.id,available:!0}))})},ce=s=>{const t=c.filter(i=>i.id!==s);L.mutate({agencyId:a,date:l,mealType:r,items:t.map(i=>({id:i.id,available:!0}))})},oe=[{value:"main",label:"Main Course"},{value:"side",label:"Side Dish"},{value:"bread",label:"Bread"},{value:"rice",label:"Rice"},{value:"dessert",label:"Dessert"},{value:"beverage",label:"Beverage"},{value:"snack",label:"Snack"}];return ne?e.jsx($,{children:e.jsx(ue,{})}):e.jsxs($,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Menu Management"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Manage your menu items and daily menus"})]}),e.jsxs(x,{onClick:()=>y(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Menu Item"]})]}),e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-secondary-400"}),e.jsx(w,{type:"date",value:l,onChange:s=>J(s.target.value),className:"w-40"})]}),e.jsx("div",{className:"flex gap-2",children:Object.entries(z).map(([s,t])=>e.jsx("button",{onClick:()=>W(s),className:`px-4 py-2 rounded-lg font-medium transition-colors ${r===s?"bg-primary-600 text-white":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200"}`,children:t},s))})]})})}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{children:[z[r]," Menu"]}),e.jsx("p",{className:"text-sm text-secondary-500 mt-1",children:xe(l,"EEEE, dd MMMM")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E[r]&&e.jsxs("span",{className:"text-sm text-secondary-500 flex items-center gap-1",children:[e.jsx(ve,{className:"h-4 w-4"}),"Cutoff: ",E[r]]}),M?e.jsxs(x,{variant:"secondary",size:"sm",onClick:()=>te.mutate({mealType:r}),children:[e.jsx(Me,{className:"h-4 w-4 mr-1"}),"Unlock"]}):e.jsxs(x,{variant:"warning",size:"sm",onClick:()=>ae.mutate({mealType:r}),disabled:c.length===0,children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"Lock Menu"]})]})]}),e.jsx(k,{children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-secondary-500",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No items in today's menu"}),e.jsx("p",{className:"text-sm",children:"Add items from the catalog"})]}):e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary-900",children:s.name}),e.jsx("p",{className:"text-sm text-secondary-500",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-primary-600",children:B(s.price)}),!M&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>ce(s.id),className:"text-danger-600",children:e.jsx(V,{className:"h-4 w-4"})})]})]},s.id))})})]}),e.jsxs(C,{children:[e.jsxs(H,{children:[e.jsx(K,{children:"Menu Catalog"}),e.jsx("p",{className:"text-sm text-secondary-500",children:"Click to add/remove items from today's menu"})]}),e.jsx(k,{children:T.length===0?e.jsxs("div",{className:"text-center py-8 text-secondary-500",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No menu items yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Add Menu Item" to create items'})]}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T.map(s=>{const t=F(s.id);return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg transition-colors ${t?"bg-primary-50 border-2 border-primary-300":"bg-secondary-50"}`,children:[e.jsxs("button",{onClick:()=>le(s),disabled:M,className:"flex-1 flex items-center justify-between text-left disabled:opacity-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-secondary-900",children:s.name}),e.jsx("p",{className:"text-sm text-secondary-500",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-primary-600",children:B(s.price)}),t?e.jsx(Ie,{className:"h-5 w-5 text-primary-600"}):e.jsx(U,{className:"h-5 w-5 text-primary-600"})]})]}),e.jsx("button",{onClick:i=>{i.stopPropagation(),confirm(`Delete "${s.name}" from catalog?`)&&se.mutate(s.id)},className:"ml-2 p-2 text-danger-600 hover:bg-danger-50 rounded-lg transition-colors",title:"Delete from catalog",children:e.jsx(V,{className:"h-4 w-4"})})]},s.id)})})})]})]})]}),e.jsx(je,{isOpen:Y,onClose:()=>{y(!1),G(null),b()},title:"Add Menu Item",size:"md",children:e.jsxs("form",{onSubmit:X(ie),className:"space-y-4",children:[e.jsx(w,{label:"Item Name",placeholder:"Enter item name",error:(q=N.name)==null?void 0:q.message,...j("name")}),e.jsx(ge,{label:"Description (Optional)",placeholder:"Describe the item",...j("description")}),e.jsx(w,{label:"Price (â‚¹)",type:"number",step:"0.01",placeholder:"Enter price",error:(Q=N.price)==null?void 0:Q.message,...j("price")}),e.jsx(fe,{label:"Category",options:oe,error:(O=N.category)==null?void 0:O.message,...j("category")}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"button",variant:"secondary",className:"flex-1",onClick:()=>{y(!1),b()},children:"Cancel"}),e.jsxs(x,{type:"submit",className:"flex-1",isLoading:S.isPending,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Save Item"]})]})]})})]})}export{Ge as default};
