import{a as A,e as P,r as x,j as e,P as z,M as R,b,f as w,h as B,z as l}from"./index-Bz7pwbB9.js";import{u as T}from"./useQuery-BBL-UJvn.js";import{u as C}from"./useMutation-bJ9c7Hmc.js";import{o as h}from"./api-Bp1mAEYF.js";import{L as M,C as u,a as p,X as F}from"./Card-D8tmHTuL.js";import{B as q,S as I}from"./Badge-DsqiXPr3.js";import{E as Q}from"./EmptyState-BtxfN_BO.js";import{M as H}from"./Modal-CfOO-JW_.js";import{T as U}from"./Input-DkrhA-KG.js";import{c as _,B as i}from"./Button-DxGI9h4D.js";import{C as K}from"./clock-A7at3eyY.js";import{U as k}from"./user-BIVSRI51.js";import{C as O}from"./check-BZlzTsAS.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=_("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);function le(){var v;const{userData:c}=A(),j=P(),[X,L]=x.useState(null),[a,t]=x.useState(null),[g,n]=x.useState(""),d=c==null?void 0:c.houseId,{data:o,isLoading:E}=T({queryKey:["houseRequests",d],queryFn:()=>h.getManualRequests(d),enabled:!!d}),f=C({mutationFn:s=>h.approveManualRequest(s),onSuccess:()=>{l.success("Request approved!"),L(null),j.invalidateQueries(["houseRequests"])},onError:s=>{l.error(s.message||"Failed to approve request")}}),N=C({mutationFn:({requestId:s,reason:S})=>h.rejectManualRequest(s,S),onSuccess:()=>{l.success("Request rejected"),t(null),n(""),j.invalidateQueries(["houseRequests"])},onError:s=>{l.error(s.message||"Failed to reject request")}}),m=((v=o==null?void 0:o.data)==null?void 0:v.requests)||[],r=m.filter(s=>s.status==="pending"),y=m.filter(s=>s.status!=="pending");return E?e.jsx(M,{children:e.jsx(z,{})}):e.jsxs(M,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-secondary-900",children:"Manual Requests"}),e.jsx("p",{className:"text-secondary-600 mt-1",children:"Approve or reject manual consumption requests from members"})]}),r.length>0&&e.jsx(u,{className:"bg-warning-50 border-warning-200",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-warning-100 rounded-lg",children:e.jsx(K,{className:"h-6 w-6 text-warning-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-warning-700",children:"Pending Approval"}),e.jsxs("p",{className:"text-2xl font-bold text-warning-900",children:[r.length," requests"]})]})]})})}),r.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary-900",children:"Pending Requests"}),r.map(s=>e.jsx(u,{className:"border-warning-200",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-warning-50 rounded-lg",children:e.jsx(k,{className:"h-6 w-6 text-warning-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-secondary-900",children:s.memberName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary-500",children:[e.jsx(q,{variant:"secondary",size:"sm",children:R[s.mealType]}),e.jsx("span",{children:b(s.date)})]}),s.notes&&e.jsxs("p",{className:"text-sm text-secondary-600 mt-1",children:['"',s.notes,'"']})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-secondary-900",children:w(s.totalAmount)}),e.jsx("p",{className:"text-xs text-secondary-500",children:B(s.createdAt)})]}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>t(s),children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(i,{variant:"success",size:"sm",onClick:()=>f.mutate(s.id),isLoading:f.isPending,children:e.jsx(O,{className:"h-4 w-4"})})]})]})})},s.id))]}),y.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-secondary-900",children:"Past Requests"}),y.map(s=>e.jsx(u,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-secondary-100 rounded-lg",children:e.jsx(k,{className:"h-6 w-6 text-secondary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-secondary-900",children:s.memberName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary-500",children:[e.jsx(q,{variant:"secondary",size:"sm",children:R[s.mealType]}),e.jsx("span",{children:b(s.date)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"font-medium text-secondary-900",children:w(s.totalAmount)}),e.jsx(I,{status:s.status})]})]})})},s.id))]}),m.length===0&&e.jsx(Q,{icon:V,title:"No Requests",description:"Manual consumption requests from members will appear here"})]}),e.jsx(H,{isOpen:!!a,onClose:()=>{t(null),n("")},title:"Reject Request",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-secondary-600",children:["Reject request from ",e.jsx("span",{className:"font-semibold",children:a==null?void 0:a.memberName}),"?"]}),e.jsx(U,{label:"Reason (optional)",placeholder:"Enter reason for rejection...",value:g,onChange:s=>n(s.target.value),rows:3}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{variant:"secondary",className:"flex-1",onClick:()=>{t(null),n("")},children:"Cancel"}),e.jsx(i,{variant:"danger",className:"flex-1",onClick:()=>N.mutate({requestId:a.id,reason:g}),isLoading:N.isPending,children:"Reject"})]})]})})]})}export{le as default};
